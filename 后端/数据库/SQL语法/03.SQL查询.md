

# SQL查询









- **聚合查询**

  > *聚合函数就是计算函数*,SQL提供了专门的聚合函数，使用聚合函数进行查询，就是聚合查询，它可以快速获得结果

  - 语法: *SELECT 聚合函数 FROM <表名>*  
  - `COUNT(列名)`获取当前列的总数量,如果当前行的值为null,是不会统计进总数,因此如果想要获取当前的总数量, 使用 *count(id)*
  - `SUM(列名)` 计算当前列的总计,该列必须为数值类型
  - `AVG(列名)` 计算当前列的平均值,该列必须为数值类型
  - `MAX(列名)` 获取当前列的最大值
  - `MIN(列名)` 获取当前列的最小值
  - 使用SQL提供的聚合查询，我们可以方便地计算总数、合计值、平均值、最大值和最小值；聚合查询也可以添加`WHERE`条件。

- **多表查询**

  >  SELECT查询不但可以从一张表查询数据，还可以从多张表同时查询数据。*多表查询的结果集可能非常巨大，要避免使用。*

  - 语法:*SELECT <字段> FROM <表1>,<表2>*

    

- - 








#### 1.基本查询

- 语句: *SELECT <查询字段> FROM <表名>*   
- 说明: 查询字段:*代表所有, 可以可以按字段查询,多个字段用多逗号分开
- 表名后面可以跟上 where 后面加条件

#### 2.别名

> 可以通过 `as`关键字给*字段*或者*表*起别名,*只是将的查询结果列名替换为别名，原表列名不会变*

- 字段: *SELECT `<查询字段> as <别名>` FROM <表名>*
- 表: *SELECT <查询字段> FROM `<表名> as <别名>`*
- 可以省略 as 在字段后面或者是表后面,直接跟上别名即可: 语法: *SELECT `s.GRADE G` FROM `salgrade s`* 

#### 3.字段使用数学表达式

> 可以对`字段使用数学表达式`,不过要注意,如果该字段不是数值,则会返回0

- 语法: *SELECT `<字段*12>` FROM <表名>*

#### 4.条件查询

> 在查询表的时候,后面可以跟上 where 然后加条件去筛选表中的数据

- 语法: *<表名> where <条件表达式1> and <条件表达式2>...* 
- **关键字:**
  - `and`表示同时满足, 
  - `or`表示满足其中之一,
  - `not`表示“不符合该条件”的记录
- 如果不加括号，条件运算按照`NOT`、`AND`、`OR`的优先级进行，即`NOT`优先级最高，其次是`AND`，最后是`OR`。加上括号可以改变优先级。
- **条件表达式:**
  - **between and **查询两个值之间数据
    - 语法 : *where <字段> `between … and ….`* 
    - 例子 : `where code between 10 and 30`  找出编号10到30之间的数据
    - 说明 :查询两个值之间数据
    - 使用between and的时候，必须遵循*左小右大*。between and是闭区间，包括两端的值。
  - **is null 和 is not null**
    - 语法 : *where <字段> `is null`*  
    - 例子 : `where name is not null`  找出名字不为空的
    - 说明 : is null 为 null（is not null 不为空）
    - 注意 ：在数据库当中*null不能使用等号进行衡量*。需要使用is null 因为数据库中的null代表什么也没有，它不是一个值
  - **like模糊查询**
    - 语法 : *WHERE <字段> Like "条件"*  
    - 例子 :  `WHERE name Like "%小%"`  找出所有名字中带小的
    - 其中关于条件，SQL提供了四种匹配模式：
      - %：*表示任意0个或多个字符*。可匹配任意类型和长度的字符  例子: '%好'
      - _： *表示任意单个字符*。匹配单个任意字符，它常用来限制表达式的字符长度语句：
      - [ ]：表示括号内所列字符中的一个（类似正则表达式）。指定一个字符、字符串或范围，要求所匹配对象为它们中的任一个。
        - 比如 SELECT * FROM [user] WHERE u_name *LIKE '[张李王]三' 将找出“张三”、“李三”、“王三”（而不是“张李王三”）*；
        - 如 [ ] 内有一系列字符（01234、abcde之类的）则可略写为“0-4”、“a-e” SELECT * FROM [user] WHERE u_name LIKE '老[1-9]' 将找出“老1”、“老2”、……、“老9”； 4，：表示不在括号所列之内的单个字符。其取值和 [] 相同，但它要求所匹配对象为指定字符以外的任一个字符。
  - **排序**
    - 语句 : *ORDER BY <排序字段> <ASC或者DESC>*  
    - 例子 : `ORDER BY name DESC`  名字按从大到小排序
    - 说明 : ASC 从小到大, DESC 从大到小,  *排序语句在条件查询最后面,*
    - 默认的排序规则是`ASC`：“升序”，即从小到大。`ASC`可以省略不写
    - 可以同时用多个字段一起排序,谁在前面,谁是主,按主序排,如果一样才使用后面的

#### 5.数据处理函数

> *数据处理函数又被称为单行处理函数,单行处理函数的特点：一个输入对应一个输出*。和单行处理函数相对的是：多行处理函数。（多行处理函数特点：多个输入，对应1个输出！）

- **lower 转换小写**
  - 语法 : *SELECT `lower(字段)` FROM 表名*
  - 例子 : `SELECT lower(job) FROM class`   将job字段下面的所有数据都转换为小写
- **upper 转换大写**
  - 语法: *SELECT `upper(字段)` FROM 表*
  - 例子: SELECT upper(`name`) FROM class把name字段的所有数据都转换大写
- **substr 截取字符串**
  - 语法 : *SELECT `substr(字段,开始位置,结束位置)` FROM  <表>*
  - 例子 : `SELECT substr(name,1,2) FROM class`  字符串截取,开始的下标是1,
- **concat 拼接字符串**
  - 语法 : *SELECT `CONCAT(字段,拼接内容1,2)`   FROM 表*
  - 例子:  SELECT CONCAT(`name`,id)   FROM `员工` : 将字段为name的数据,都拼接上id字段
  - 说明: 拼接内容可以是单纯的字符串,也可是是和字段拼接
- **trim 去除空格**
- **str_to_date 将字符串转换成日期**
- **round 四舍五入**
- 

#### 6.分组计算

>  一共有五个计算函数 count计数, sum求和, avg平均值, max最大值, min最小值,*如果没有进行分组,则把整个表当做是一个组,如果分组了,只会计算组内的数据*  也可以通过where条件来对字段进行分组,然后计算

- 语法 :  *SELECT  `计算函数(字段)` FROM <表>*
- 例子1 :  `SELECT  count(id) FROM 表` 求表中id的数量
- 例子2 :  `SELECT  max(wages) FROM 表` 求字段wages的最大值
- 例子3 : 求工资大于200的人数   `select count(wages) from 员工 WHERE wages >2000`

#### 7.分组查询

> *分组查询,就是把字段中相同的值作为一组*,也可以利用它来去重

- 语法:  *select 字段 from <表> `group by <字段>`*
- 例子: `select * from 表 group by name` 根据name字段进行分组
- 结合分组计算语法: *select 分组计算(字段) from 表 GROUP BY 字段*
- 例子: `select SUM(wages) from 员工 GROUP BY name` 根据name进行分组,然后计算每组的和

#### 7.分页查询

- 语句: *LIMIT <条数> OFFSET <开始的位置>* 开始位置从0开始
- 说明: 分页实际上就是从结果集中“截取”出第M~N条记录, 和js中截取数组元素一样.
- `LIMIT`总是设定为`pageSize` 
- `OFFSET`计算公式为`pageSize * (pageIndex - 1)`
- 分页查询需要先确定每页的数量和当前页数，然后确定`LIMIT`和`OFFSET`的值。
- 可以简写成 **LIMIT 开始位置,条数**  
- 例子: 
- 先查 后排序 再进行分页



#### JOIN连接查询(多表查询)

> *连接查询是另一种类型的多表查询*。连接查询对多个表进行JOIN运算，简单地说，就是先*确定一个主表作为结果集*，然后，把其他表的行有选择性地“连接”在主表结果集上。*可以通过JOIN 多个表, 通过 ON 来确定链接条件*
>
> 

- 语法: *SELECT 表1.数据,表2.数据 FROM <表1> INNER JOIN <表2> ON <连接条件...> where<筛选条件...>*  
- 示例: SELECT s.id, s.name, s.class_id, c.name class_name FROM students s INNER JOIN classes ON s.class_id = c.id
- 先确定主表，仍然使用`FROM <表1>`的语法；
- 再确定需要连接的表，使用`INNER JOIN <表2>`的语法；
- 然后确定连接条件，使用`ON <条件...>`，这里的条件是`s.class_id = c.id`，表示`students`表的`class_id`列与`classes`表的`id`列相同的行需要连接；
- 可选：加上`WHERE`子句、`ORDER BY`等子句。





#### 7.语句顺序

- **书写顺序:** 

  - select 
    	...
    from
    	...
    where
    	...
    group by
    	...
    having
    	...
    order by
    	...

- **执行顺序**

  - 1.先确定表 2.根据条件从表中筛选数据 3.分组 4.查询select的字段, 5.排序

  - 	1. from
    	2	. where
      	3. group by
      	4. having
      	5. select
      	6. order by
      
      	从某张表中查询数据，
      	先经过where条件筛选出有价值的数据。
      	对这些有价值的数据进行分组。
      	分组之后可以使用having继续筛选。
      	select查询出来。
      	最后排序输出！

    
