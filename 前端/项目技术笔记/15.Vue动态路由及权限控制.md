

# Vue动态路由

> 设置动态路由只需要两步 1. 从后端获取路由页面信息 2. 通过 router.addRoute()方法,把路由信息添加到Router中,完成配置

1. 先设置静态的路由页面 如 登录页面,404页面,错误页面 这些静态路由的页面不从后端获取
2. 在路由的钩子函数, router.beforeEach()中,获取动态路由信息,并将信息缓存到Vuex中,用于后面渲染菜单
3. 获取到路由信息后,将路由信息对象,通过 router.addRoute() 添加到Router对象中
4. 处理 在刷新时跳转404页面问题



### 1.实现步骤：

1. 在路由的前置钩子中，根据Token判断用户是否已经登录，如果用户没有登录，则调整到登录页面，如果用户已经登录，则进入下一个步骤
2. 用户已经登录，则去Vuex中查找用户的角色信息（第一次肯定是没有），如果没有，则表示需要获取用户的信息包括（用户名称，用户角色，用户权限）（主要是用户权限），获取完成后，将用户的信息存储在Vuex中
3. 获取完成用户的信息后，根据用户的角色去获取用户的菜单，然后根据菜单信息动态生产路由，并将用户的菜单存储到Vuex中，（留给后面渲染菜单）

### 2.什么要在路由前置钩子中获取菜单和权限？

1. 因为我们的菜单和权限信息，主要存储在Vuex中。由于Vuex中的数据是存储在内存中的，当页面刷新后，数据就会丢失
2. 当页面刷新后，路由的前置钩子一定会执行，所有我们在前置钩子中判断Vuex中的角色数据是否存在
3. 如果数据存储，则表示是普通的调整，不需要获取权限和菜单，如果不存储则表示页面已经刷新，数据丢失
4. 在数据丢失后，再去发生请求获取菜单和权限等信息



### 3.根据菜单生产动态路由

- **动态生产路由的实现步骤：**
  1. 

### 3.动态路由刷新后跳转404页面问题

> 在配置完动态路由后,如果刷新页面 就会跳转到404页面

- 原因: 这是由于在进行路由跳转时,还没把动态路由添加进路由中,此时
- 解决方法: 在添加完所有的页面后,再把 通用匹配,重定向404的路由配置添加进去

